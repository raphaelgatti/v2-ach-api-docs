# Callback / Webhook

Para receber o status do seu envio online, utilize o nosso serviço de callcack. Nós chamaremos seu endpoint configurado na plataforma assim que enviarmos a sua mensagem. É fácil, é rapido e econimiza seus recursos de rede. Ao invés de fazer pooling em uma API para saber o que aconteceu com sua mensagem vamos avisa-lo assim que o evento ocorrer.

Possuimos dois tipos de status, o de entrega na operadora e para as operadoras que provem o status de entrega no aparelho.




In order to configure our system to effectively call your service with the callback details, you have to login into the [Movile Messaging API configuration](https://messaging.movile.com/messaging/user/api_configuration). On the configuration form displayed you will be able to configure the **Sent Status Callback** and the **Delivery Report Callback** URLs.

After configuring the API, we will call your URL when the following occurs:

Action                                                | Callback Service                                          
-------------------------------------------------------------------- | -----------------------
After a message have been sent to the carrier          | [Sent Status Callback](#sentstatuscallbacksample)
After the carrier delivered the message to the user's device     | [Delivery Report Callback](#deliveryreportcallbacksample)

<!-- Both needs URL and a ```http basic authentication``` username and password. -->

## Callback method
Currently, the Callbacks API supports `HTTP POST` messages. This method is pretty straightforward and easy to use. A `POST` will be made to your URL with a `Json` object on the body, which will contain the callback fields. An example of a **Sent Status Callback** `POST` message could be:

<!-- * `HTTP GET`: a call is made with all the info on the header, as a *query string* -->

<!-- On the [Configurations Panel](https://messaging.movile.com/messaging/user/api_configuration), you can set custom messages to be sent on the header of both calls. If you choose for the `GET` message method, you can choose what fields will be returned. The `POST` call configuration does not allow such changes. However, this should not be a problem for your system, as few fields less won't lower your processing considerably. We recommend the usage of the `POST` method, as it follows a common API pattern and it's easier for your service to treat the information. -->


```http
POST https://example.com/callback/
Content-Type: application/json

{
  "id":"f9c100ff-aed0-4456-898c-e57d754c439c",
  "correlationId":"client-id",
  "carrierId":1,
  "carrierName":"VIVO",
  "destination":"5511900009999",
  "sentStatusCode":2,
  "sentStatus":"SENT_SUCCESS",
  "sentAt":1266660300000,
  "sentDate":"2010-02-20T10:05:00Z",
  "campaignId":"64",
  "extraInfo":"",
}
```
<!--
#### HTTP GET

This is the old way of receiving a callback message. We do not recommend the usage of this method. If you choose to use `HTTP GET` callback messages, the following example illustrates what kind of message your service must be prepared for:

```
GET http://example.com/callback?uuid=f9c100ff-aed0-4456-898c-e57d754c439c&carrierId=1&carrierName=VIVO [...]
```

**Obs:** you can configure what fields you want to be attached on the header of your callback message on the [Configuration Panel](https://messaging.movile.com/messaging/user/api_configuration). -->

## Sent Status Callback

This callback configuration allows you to receive a report of the message as soon as it leaves Movile. Please note that when you receive this callback message the SMS may or may not have been delivered to the user's device.

#### HTTP POST

This kind of message contains the following fields on the `Json` object:

Field | Description
----- | -------
`id` | Generated `UUID` of the message  
`correlationId` | Your identifier for this message
`carrierId` | Carrier identifier
`carrierName` | Carrier name
`destination` | Phone number to which the message was sent
`sentStatusCode` | Status code generated by Movile indicating the sent status of the message. Check [Message Status Codes](appendix.html#message-status-codes) for more information
`sentStatus` | Verbose descriptor of the sent status. Check [Message Status Codes](appendix.html#message-status-codes) for more information
`sentAt` | Time sent. It is an [Epoch Date](https://en.wikipedia.org/wiki/Unix_time)
`sentDate` | Date when the message was sent. Format: `yyyy-MM-dd'T'HH:mm:ssZ`
`campaignId` | Identificator of the campaign, if it exists.
`extraInfo` | Any extra info set by the user when the message was sent

<!-- #### HTTP GET

This kind of message contains the following fields on the header of the `HTTP` call (default fields):

Field | Description
----- | -------
`uuid` | Generated `UUID` of the message  
`carrierId` | Carrier identifier
`carrierName` | Carrier name
`destination` | Phone number to which the message was sent
`sent` | ???
`messageStatusId` | Status code generated by Movile indicating the sent status of the message
`messageStatus` | Verbose descriptor of the sent status
`requestPerformedTime` | Time sent. It is an [Epoch Date](https://en.wikipedia.org/wiki/Unix_time) ??
`flag` | ?? -->


<!-- #### Callback

```http
GET /callback/sent-status?a=b&c=d HTTP/1.1
Host: example.com
Authorization: Basic YWFhOmJiYg==
```

### Callback Parameters

 * **a** any
 * **b** any
-->

## Delivery Report Callback
This callback configuration allows you to receive a report of the message as soon as it is delivered to the end-user. The fields of this callback type are similar to the *Sent Status Callback* with the addition of the delivery fields.

#### HTTP POST

This kind of message contains the following fields on the `Json` object:

Field | Description
----- | -------
`id` | Generated `UUID` of the message  
`correlationId` | Your identifier for this message
`carrierId` | Carrier identifier
`carrierName` | Carrier name
`destination` | Phone number to which the message was sent
`sentStatusCode` | Status code generated by Movile indicating the sent status of the message. Check [Message Status Codes](appendix.html#message-status-codes) for more information
`sentStatus` | Verbose descriptor of the sent status. Check [Message Status Codes](appendix.html#message-status-codes) for more information
`sentAt` | Time sent. It is an [Epoch Date](https://en.wikipedia.org/wiki/Unix_time)
`sentDate` | Date when the message was sent
`deliveredStatusCode` | Status code generated by Movile indicating the delivered status of the message. Check [Message Status Codes](appendix.html#message-status-codes) for more information
`deliveredStatus` | Verbose descriptor of the delivered status. Check [Message Status Codes](appendix.html#message-status-codes) for more information
`deliveredAt` | Time when the message was delivered. It is an [Epoch Date](https://en.wikipedia.org/wiki/Unix_time)
`deliveredDate` | Date when the message was delivered. Format: `yyyy-MM-dd'T'HH:mm:ssZ`
`campaignId` | Identificator of the campaign, if it exists
`extraInfo` | Any extra info set by the user when the message was sent

<!--
#### HTTP GET

This kind of message contains the following fields on the header of the `HTTP` call (default fields):

Field | Description
----- | -------
`uuid` | Generated `UUID` of the message  
`carrierId` | Carrier identifier
`carrierName` | Carrier name
`destination` | Phone number to which the message was sent
`sent` | ???
`messageStatusId` | Status code generated by Movile indicating the sent status of the message
`messageStatus` | Verbose descriptor of the sent status
`requestPerformedTime` | Time when the request was made. It is an [Epoch Date](https://en.wikipedia.org/wiki/Unix_time) ??
`deliveryTime` | epoch?
`flag` | ?? -->
